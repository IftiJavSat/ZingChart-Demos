<!DOCTYPE html>
<html>
  <head>
    <title>MongoDB/Mongoose Demo</title>
    <script type="text/javascript" src="./node_modules/zingchart/client/zingchart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./node_modules/foundation-sites/css/foundation.min.css">
  </head>
  <body>
    <script>
    // Generates GET requests to a URL.
    function httpGet(Url){
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", Url, false);
      xmlHttp.send(null);
      return xmlHttp.responseText;
    }

    window.onload=function(){
      // GET request to localhost:3000/test, which has been configured to send back our db data
      var aData = JSON.parse(httpGet('http://localhost:3000/test'));
      var oSeriesData = {
        aSeries0: [],
        aSeries1: [],
        aSeries2: [],
        aSeries3: []
      };

      // Push the data into the oSeriesData object's arrays.
      for(var n = 0; n < aData.length; n++){
        oSeriesData['aSeries0'].push(aData[n]['series0']);
        oSeriesData['aSeries1'].push(aData[n]['series1']);
        oSeriesData['aSeries2'].push(aData[n]['series2']);
        oSeriesData['aSeries3'].push(aData[n]['series3']);
      }

      // Render the chart using the data from Mongo
      zingchart.render({
        id:"myChart",
        width:"100%",
        height:400,
        data:{
          "type":"line",
          "title":{
            "text":"Data Pulled from MongoDB"
          },
          "plot":{
            "line-width":1,
            "aspect":"spline",
            "marker":{
              "visible":false
            }
          },
          "series":[
            {
              "values":oSeriesData['aSeries0']
            },
            {
              "values":oSeriesData['aSeries1']
            },
            {
              "values":oSeriesData['aSeries2']
            },
            {
              "values":oSeriesData['aSeries3']
            }
          ]
        }
      });
    };
    </script>

    <div class="row">
      <div class="small-12 columns">
      <h1>MongoDB Database Demo</h1>
      <div id="myChart"></div>
      </div>
    </div>
  </body>
</html>